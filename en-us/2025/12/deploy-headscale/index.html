<!doctype html><html lang=en-us><head><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying Headscale to Build a Private Tailscale Network","datePublished":"2025-12-07T00:00:00Z","dateModified":"2025-12-07T00:00:00Z","author":{"@type":"Person","name":"Alex King","image":"https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.hljin.net\/en-us\/2025\/12\/deploy-headscale\/"},"publisher":{"@type":"Organization","name":"Alex King's blog","logo":{"@type":"ImageObject","url":"https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"}},"description":" This article is translated from Chinese to English by ChatGPT. There might be errors.\nMy private home network originally used Zerotier, but I found the connection to be unstable. Even when both of my nodes had public IPs, they sometimes failed to connect. Later I switched to WireGuard, which turned out to be very stable. Recently, however, I bought several new VPS instances and a friend’s home network also joined mine. The number of nodes increased, security rules became more complex, and maintaining WireGuard started to feel overwhelming. So I finally decided to deploy Headscale and migrate to a Tailscale-based network.\n","keywords":[]}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.111.3 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content="Alex King"><meta name=keywords content><meta name=description content="
  This article is translated from Chinese to English by ChatGPT. There might be errors.

My private home network originally used Zerotier, but I found the connection to be unstable. Even when both of my nodes had public IPs, they sometimes failed to connect. Later I switched to WireGuard, which turned out to be very stable. Recently, however, I bought several new VPS instances and a friend’s home network also joined mine. The number of nodes increased, security rules became more complex, and maintaining WireGuard started to feel overwhelming. So I finally decided to deploy Headscale and migrate to a Tailscale-based network."><meta property="og:description" content="
  This article is translated from Chinese to English by ChatGPT. There might be errors.

My private home network originally used Zerotier, but I found the connection to be unstable. Even when both of my nodes had public IPs, they sometimes failed to connect. Later I switched to WireGuard, which turned out to be very stable. Recently, however, I bought several new VPS instances and a friend’s home network also joined mine. The number of nodes increased, security rules became more complex, and maintaining WireGuard started to feel overwhelming. So I finally decided to deploy Headscale and migrate to a Tailscale-based network."><meta property="og:type" content="article"><meta property="og:title" content="Deploying Headscale to Build a Private Tailscale Network"><meta name=twitter:title content="Deploying Headscale to Build a Private Tailscale Network"><meta property="og:url" content="https://blog.hljin.net/en-us/2025/12/deploy-headscale/"><meta property="twitter:url" content="https://blog.hljin.net/en-us/2025/12/deploy-headscale/"><meta property="og:site_name" content="Alex King's blog"><meta property="og:description" content="
  This article is translated from Chinese to English by ChatGPT. There might be errors.

My private home network originally used Zerotier, but I found the connection to be unstable. Even when both of my nodes had public IPs, they sometimes failed to connect. Later I switched to WireGuard, which turned out to be very stable. Recently, however, I bought several new VPS instances and a friend’s home network also joined mine. The number of nodes increased, security rules became more complex, and maintaining WireGuard started to feel overwhelming. So I finally decided to deploy Headscale and migrate to a Tailscale-based network."><meta name=twitter:description content="
  This article is translated from Chinese to English by ChatGPT. There might be errors.

My private home network originally used Zerotier, but I found the connection to be unstable. Even when both of my nodes had public IPs, they sometimes failed to connect. Later I switched to WireGuard, which turned out to be very stable. Recently, however, I bought several new VPS instances and a friend’s home network also joined mine. The number of nodes increased, security rules became more complex, and maintaining WireGuard started to feel overwhelming. So I finally decided to deploy Headscale and migrate to a Tailscale-based network."><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2025-12-07T00:00:00"><meta property="article:modified_time" content="2025-12-07T00:00:00"><meta property="article:tag" content="headscale"><meta property="article:tag" content="headplane"><meta property="article:tag" content="tailscale"><meta property="article:tag" content="openwrt"><meta name=twitter:card content="summary"><meta property="og:image" content="https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"><meta property="twitter:image" content="https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"><title>Deploying Headscale to Build a Private Tailscale Network</title><link rel=icon href=https://blog.hljin.net/favicon.png><link rel=canonical href=https://blog.hljin.net/en-us/2025/12/deploy-headscale/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css integrity="sha512-MLcK/YRapzET1qTBXrOiZE6bGBgtATMo2bIyalVJ8EKDEGNoeA3SPQkvWAR0zNS650YG13ocXBMeioDuZcSRuQ==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://blog.hljin.net/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css><link rel=stylesheet href=https://blog.hljin.net/css/override.css></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=https://blog.hljin.net/en-us/ aria-label="Go to homepage">Alex King's blog</a></div><a class=header-right-picture href=https://blog.hljin.net/#about aria-label="Open the link: /#about"><img class=header-picture src=https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg alt="Author's picture"></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=https://blog.hljin.net/#about aria-label="Read more about the author"><img class=sidebar-profile-picture src=https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg alt="Author's picture"></a><h4 class=sidebar-profile-name>Alex King</h4><h5 class=sidebar-profile-bio>Observing without evaluating is the highest form of human intelligence</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/en-us/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>Home</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/en-us/categories title=Categories><i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden=true></i>
<span class=sidebar-button-desc>Categories</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/en-us/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>Tags</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/en-us/archives title=Archives><i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden=true></i>
<span class=sidebar-button-desc>Archives</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/en-us/#about title=About><i class="sidebar-button-icon fas fa-lg fa-user" aria-hidden=true></i>
<span class=sidebar-button-desc>About</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/core2duoe6420 target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span></a></li></ul><ul class=sidebar-buttons></ul></div></nav><div id=main data-behavior=4 class=hasCoverMetaIn><article class=post id=top><div class="post-header main-content-wrap text-left"><h1 class=post-title>Deploying Headscale to Build a Private Tailscale Network</h1><div class="postShorten-meta post-meta"><time datetime=2025-12-07T00:00:00Z>December 7, 2025</time></div></div><div class="post-content markdown"><div class=main-content-wrap><div class="alert warning"><p>This article is translated from Chinese to English by ChatGPT. There might be errors.</p></div><p>My private home network originally used Zerotier, but I found the connection to be unstable. Even when both of my nodes had public IPs, they sometimes failed to connect. Later I switched to WireGuard, which turned out to be very stable. Recently, however, I bought several new VPS instances and a friend’s home network also joined mine. The number of nodes increased, security rules became more complex, and maintaining WireGuard started to feel overwhelming. So I finally decided to deploy Headscale and migrate to a Tailscale-based network.</p><p>There is no shortage of information online about Headscale and Tailscale, but much of it is repetitive. Many guides still deploy Headscale directly on bare metal and spend long sections explaining how to configure auto-start with systemd, which I found frustrating. Some resources are outdated or unclear, and even the official Tailscale documentation is not always entirely accurate. Furthermore, Headscale does not implement all of Tailscale’s features, which makes it easy to run into pitfalls. Half documentation and half tutorial, this article introduces my deployment approach and configuration. Readers are expected to understand the details and adapt them flexibly to their own environments.</p><h2 id=environment-and-architecture>Environment and Architecture</h2><p>The deployment environment and solution described in this article are as follows:</p><ul><li><p>Headscale version <code>0.27.1</code>; Headplane is used as the UI management interface, version <code>0.6.2-beta.2</code> (the reason for using the beta version is explained later); Docker version <code>29.1.1</code>. This version of Headscale requires Tailscale clients to be at least <code>1.64.0</code>. The latest Tailscale version at present is <code>1.90.9</code>.</p></li><li><p>Headscale is deployed on an overseas server using the built-in DERP service. At the same time, an additional DERP server is deployed inside mainland China to accelerate connectivity. This is mainly because my domain is not ICP-registered, so I cannot deploy Headscale directly inside China. I tried using a self-signed certificate with a direct IP address. On Ubuntu, adding a system CA worked fine, but one of my clients runs OpenWrt, and I could not get the certificate imported no matter what I tried, so I had to give up.</p></li><li><p>The examples in this article use the following parameters. Please adjust them according to your own situation:</p><ul><li><p>Headscale + Headplane server</p><ul><li>Headscale domain: <code>hs.example.com</code></li><li>IP address: <code>48.1.1.1</code></li><li>HTTPS listens on <code>40000</code></li><li>Built-in DERP STUN listens on UDP port <code>41000</code></li><li>Other ports such as <code>metrics</code> and <code>grpc</code> are ignored</li><li>Caddy is used to reverse proxy Headscale and Headplane. Caddy obtains certificates via ACME using DNS-01 challenges. The domain is hosted on Cloudflare, and the API key is <code>cloudflare-dns-api-key</code></li><li>The public domain for Headplane is <code>hp.example.com</code>, sharing port <code>40000</code>. I also enabled mTLS for security; readers can decide for themselves whether mTLS is necessary</li></ul></li><li><p>Mainland China DERP server</p><ul><li>IP address: <code>47.1.1.1</code></li><li>HTTPS listens on <code>40000</code></li><li>STUN listens on <code>41000</code></li><li>No HTTP port required</li><li>ICMP does not need to be opened (the official documentation says it is required, but in practice it works without it)</li><li>Uses a self-signed certificate</li></ul></li></ul></li></ul><h2 id=headscale-server-configuration>Headscale Server Configuration</h2><p>Prepare the following configuration files. Due to space limitations, the files provided here have official comments removed or some content omitted. You can find the full examples with detailed comments in the official repository.</p><h4 id=docker-composeyaml><code>docker-compose.yaml</code></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>headscale</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>headscale/headscale:v0.27.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>headscale</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>1000</span>:<span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./headscale/config.yaml:/etc/headscale/config.yaml</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./headscale/derp.yaml:/etc/headscale/derp.yaml</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./headscale/data:/var/lib/headscale</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./headscale/run:/var/run/headscale</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;41000:41000/udp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: <span style=color:#ae81ff>serve</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>headscale-net</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>headplane</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/tale/headplane:0.6.2-beta.2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>headplane</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>1000</span>:<span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./headplane/config.yaml:/etc/headplane/config.yaml</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./headscale/config.yaml:/etc/headscale/config.yaml</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./headplane/data:/var/lib/headplane</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/run/docker.sock:/var/run/docker.sock:ro </span> <span style=color:#75715e># See explanation below</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>headscale-net</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>group_add</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>${DOCKER_GROUP}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>caddy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>caddy</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>caddy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>1000</span>:<span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;40000:40000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>CF_API_TOKEN</span>: <span style=color:#ae81ff>cloudflare-dns-api-key</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./caddy/Caddyfile:/etc/caddy/Caddyfile:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./caddy/certs:/certs:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./caddy/data:/data</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./caddy/config:/config</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>headscale-net</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>headscale-net</span>:
</span></span></code></pre></div><h4 id=headscaleconfigyaml><code>headscale/config.yaml</code></h4><p>Headscale configuration file, <a href=https://github.com/juanfont/headscale/blob/main/config-example.yaml>official example</a>. If you do not need additional DERP servers, you can set <code>derp.paths</code> to an empty array.</p><pre tabindex=0><code>server_url: https://hs.example.com:40000
listen_addr: 0.0.0.0:8080
metrics_listen_addr: 127.0.0.1:9090
grpc_listen_addr: 127.0.0.1:50443
grpc_allow_insecure: false
noise:
  private_key_path: /var/lib/headscale/noise_private.key
prefixes:
  v4: 100.64.0.0/10
  allocation: sequential
derp:
  server:
    enabled: true
    region_id: 999
    region_code: &#34;headscale&#34;
    region_name: &#34;Headscale Embedded DERP&#34;
    verify_clients: true
    stun_listen_addr: &#34;0.0.0.0:41000&#34;
    private_key_path: /var/lib/headscale/derp_server_private.key
    automatically_add_embedded_derp_region: true
    ipv4: 48.1.1.1
  urls: []
  paths: [&#34;/etc/headscale/derp.yaml&#34;]
  auto_update_enabled: false
  update_frequency: 24h
disable_check_updates: true
ephemeral_node_inactivity_timeout: 30m
# database, log, unix_socket can remain default and are omitted here
policy:
  mode: database
dns:
  magic_dns: true
  base_domain: ts.net
  override_local_dns: false
  nameservers:
    global: [&#34;223.5.5.5&#34;]
    split: {}
  search_domains: []
  extra_records: []
# Setting this to true makes Tailscale ignore the --port parameter at startup and use a random port
randomize_client_port: false
</code></pre><h4 id=headscalederpyaml><code>headscale/derp.yaml</code></h4><p>Configuration for the additional DERP server. If you do not need it, you can omit this file and remove the corresponding volume from <code>docker-compose.yaml</code>.</p><pre tabindex=0><code>regions:
  900:
    regionid: 900
    regioncode: china
    regionname: China
    nodes:
      - name: node
        regionid: 900
        hostname: 47.1.1.1
        ipv4: 47.1.1.1
        stunport: 41000
        derpport: 40000
        insecurefortests: true
        stunonly: false
        canport80: false
</code></pre><h4 id=headplaneconfigyaml><code>headplane/config.yaml</code></h4><p>Headplane configuration file, <a href=https://github.com/tale/headplane/blob/main/config.example.yaml>official example</a>. If you do not need the Web UI, you can skip deploying it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cookie_secret</span>: <span style=color:#e6db74>&#34;Please generate a random 32-character string yourself: tr -dc &#39;A-Za-z0-9&#39; &lt; /dev/urandom | head -c 32&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cookie_secure</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cookie_max_age</span>: <span style=color:#ae81ff>86400</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>data_path</span>: <span style=color:#e6db74>&#34;/var/lib/headplane&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>headscale</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;http://headscale:8080&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>public_url</span>: <span style=color:#ae81ff>https://hs.example.com:40000</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config_path</span>: <span style=color:#e6db74>&#34;/etc/headscale/config.yaml&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>config_strict</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#f92672>integration</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>agent</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>docker</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># See explanation below</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#e6db74>&#34;headscale&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>socket</span>: <span style=color:#e6db74>&#34;unix:///var/run/docker.sock&#34;</span>
</span></span></code></pre></div><h4 id=caddycaddyfile><code>caddy/Caddyfile</code></h4><p>Caddy configuration file, <a href=https://caddyserver.com/docs/caddyfile>official documentation</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{
</span></span><span style=display:flex><span>    https_port 40000
</span></span><span style=display:flex><span>    auto_https disable_redirects
</span></span><span style=display:flex><span>    admin off
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(cloudflare) {
</span></span><span style=display:flex><span>    dns cloudflare {env.CF_API_TOKEN}
</span></span><span style=display:flex><span>    resolvers 1.1.1.1
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hs.example.com:40000 {
</span></span><span style=display:flex><span>    tls {
</span></span><span style=display:flex><span>        import cloudflare
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    reverse_proxy headscale:8080
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hp.example.com:40000 {
</span></span><span style=display:flex><span>    tls {
</span></span><span style=display:flex><span>        import cloudflare
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        # mTLS client verification; not required if Headplane is not exposed to the public internet
</span></span><span style=display:flex><span>        client_auth {
</span></span><span style=display:flex><span>            trust_pool file /certs/my_CA.crt
</span></span><span style=display:flex><span>            mode require_and_verify
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    reverse_proxy headplane:3000
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=caddydockerfile><code>caddy/Dockerfile</code></h4><p>This is the Dockerfile used to build the Caddy image. DNS support in Caddy is provided via plugins and must be compiled manually. If you use a different DNS provider, replace the plugin accordingly. All DNS plugins officially supported by Caddy can be found <a href="https://github.com/orgs/caddy-dns/repositories?type=all">here</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>FROM caddy:builder AS builder
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RUN xcaddy build \
</span></span><span style=display:flex><span>    --with github.com/caddy-dns/cloudflare
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>FROM caddy:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>COPY --from=builder /usr/bin/caddy /usr/bin/caddy
</span></span></code></pre></div><h3 id=deployment-instructions>Deployment Instructions</h3><p>All containers here run as user <code>1000:1000</code>, so before starting, make sure that all mounted directories are readable and writable by user <code>1000</code>. If Docker creates the directories automatically, they will be owned by root, which will cause permission issues. Run the following commands to start the services:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p headscale/<span style=color:#f92672>{</span>data,run<span style=color:#f92672>}</span> headplane/data caddy/<span style=color:#f92672>{</span>data,config,certs<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>export DOCKER_GROUP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>getent group docker | cut -d: -f3<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>sudo -E docker compose up -d
</span></span></code></pre></div><p>The <code>DOCKER_GROUP</code> environment variable is used in <code>docker-compose.yaml</code> to allow Headplane to read <code>/var/run/docker.sock</code> and integrate with the Headscale container.</p><p>Access Headplane at <code>https://hp.example.com:40000/admin/</code>. On first access, you will be prompted to enter a Headscale API key, which can be generated using:</p><pre tabindex=0><code>sudo docker exec headscale headscale apikeys create -e 999d
</code></pre><p>It is recommended to keep this key, because you will need to re-enter it every time you switch browsers. Constantly regenerating it is inconvenient.</p><p>Then, on a client with Tailscale installed, run:</p><pre tabindex=0><code>sudo tailscale up --login-server https://hs.example.com:40000
</code></pre><p>Follow the prompts to complete the login process.</p><h2 id=derp-server>DERP Server</h2><p>To deploy the DERP server, prepare a self-signed certificate. Name the private key and certificate as <code>47.1.1.1.key</code> and <code>47.1.1.1.crt</code>, and place them in the <code>certs</code> directory. Replace the IP with your own IP or domain (if you have ICP registration). This naming convention is required by DERP.</p><p>Then prepare the <code>docker-compose.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>derper</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>fredliang/derper:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>derper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>41000</span>:<span style=color:#ae81ff>41000</span><span style=color:#ae81ff>/udp</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>40000</span>:<span style=color:#ae81ff>40000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_DOMAIN</span>: <span style=color:#e6db74>&#34;47.1.1.1&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_CERT_MODE</span>: <span style=color:#ae81ff>manual</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_CERT_DIR</span>: <span style=color:#ae81ff>/certs</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_ADDR</span>: <span style=color:#e6db74>&#34;:40000&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_STUN</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_STUN_PORT</span>: <span style=color:#e6db74>&#34;41000&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_HTTP_PORT</span>: <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># See explanation below</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DERP_VERIFY_CLIENTS</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># DERP_VERIFY_CLIENT_URL: https://hs.example.com:40000/verify</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./certs:/certs</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># See explanation below</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/run/tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock</span>
</span></span></code></pre></div><p>Start it with <code>sudo docker-compose up -d</code>. Note that this server is also a tailnet node in my case, so I can use <code>/var/run/tailscale/tailscaled.sock</code> to verify authenticated clients. If that is not the case for you, consider using <code>DERP_VERIFY_CLIENT_URL</code> instead, though there may be pitfalls (explained below).</p><p>On the node, use <code>tailscale netcheck</code> and <code>tailscale debug derp-map</code> to verify that the DERP server is being obtained and connected successfully.</p><h2 id=pitfalls-and-lessons-learned>Pitfalls and Lessons Learned</h2><h3 id=headplane-and-docker-compatibility-issues>Headplane and Docker Compatibility Issues</h3><p>Docker 29 raised the minimum API version requirement, causing compatibility issues with many clients. Portainer encountered this problem before, and now Headplane ran into it as well. Initially, I used the stable version <code>0.6.1</code>, but it simply could not connect to Docker. The logs were extremely misleading and contained no hints about API compatibility at all. Fortunately, this issue has already been fixed in <a href=https://github.com/tale/headplane/pull/370>this PR</a>. Using the <code>0.6.2-beta.2</code> image resolves the problem.</p><h3 id=implementation-limitations>Implementation Limitations</h3><p>During deployment, I discovered that some Tailscale features are not implemented in Headscale. The more niche the feature, the more likely it is missing. The issues I encountered include:</p><ul><li>ACL does not support IP sets. See <a href=https://github.com/juanfont/headscale/issues/2409>this issue</a>. The developers are fully focused on implementing the new grants feature and probably have no time to maintain the old ACL system. Fortunately, the same effect can be achieved by expanding the rules manually, though it leads to duplication.</li><li>DNS does not support wildcards such as <code>*.example.com</code>. See <a href=https://github.com/juanfont/headscale/issues/2508>this issue</a>. This seems to be a limitation of Tailscale itself.</li></ul><h3 id=derp-service-issues>DERP Service Issues</h3><p>Two major pitfalls arose during the DERP deployment. The first was the <code>InsecureForTests</code> flag. This flag is critical for self-signed certificate environments, as it tells Tailscale to ignore certificate errors. Initially, I was misled by <a href=https://linux.do/t/topic/171651>this post</a>, which claimed that when Headscale loads DERP configuration from a local YAML file, <code>InsecureForTests</code> is not supported and that only URL-based configuration works. This turned out to be incorrect. <a href=https://gist.github.com/zhangguanzhang/db9f6862eef4c82f6918852953a48458>This article</a> is the accurate reference: local YAML files fully support <code>InsecureForTests</code>.</p><p>The second issue involved the <code>derper</code> parameters <code>--verify-clients</code> and <code>--verify-client-url</code> (configured as <code>DERP_VERIFY_CLIENTS</code> and <code>DERP_VERIFY_CLIENT_URL</code> in the <code>docker-compose.yaml</code> above). These are meant to prevent abuse of the DERP server. Initially, I assumed that client verification had to go through Headscale, so I tried using <code>--verify-client-url</code>. I also assumed that <code>--verify-clients</code> was simply a toggle, and that <code>--verify-client-url</code> would only take effect when <code>--verify-clients</code> was set to <code>true</code>. After struggling for quite some time, I finally realized that these two parameters are mutually exclusive. <code>--verify-clients</code> means retrieving user information from the local <code>/var/run/tailscale/tailscaled.sock</code>. To use <code>--verify-client-url</code>, <code>--verify-clients</code> must first be set to <code>false</code>. However, even with <code>--verify-client-url</code>, DERP still failed to verify clients in my setup. This might be due to network topology, since my Headscale server is overseas. At that point, I realized that client verification ultimately only requires public key information. Even if someone spoofs a public key, they still cannot communicate with other nodes without the corresponding private key. Therefore, verifying clients using local Tailscale node information is perfectly reasonable.</p><h3 id=alibaba-cloud-compatibility-issue>Alibaba Cloud Compatibility Issue</h3><p>Alibaba Cloud’s internal network also uses the <code>100.64.0.0/10</code> CGNAT range. For example, Alibaba Cloud’s DNS server is <code>100.100.2.136</code>, and the APT mirror <code>mirrors.cloud.aliyuncs.com</code> also falls within this range. For security reasons, Tailscale inserts an iptables rule by default to drop all <code>100.64.0.0/10</code> packets that do not originate from the Tailscale network interface. The rule looks like this:</p><pre tabindex=0><code>Chain ts-input (1 references)
 pkts bytes target     prot opt in          out     source               destination
    0     0 ACCEPT     0    --  lo          *       100.64.0.4           0.0.0.0/0
    0     0 RETURN     0    --  !tailscale0 *       100.115.92.0/23      0.0.0.0/0
    0     0 DROP       0    --  !tailscale0 *       100.64.0.0/10        0.0.0.0/0
11231  587K ACCEPT     0    --  tailscale0  *       0.0.0.0/0            0.0.0.0/0
13256 1659K ACCEPT     17   --  *           *       0.0.0.0/0            0.0.0.0/0            udp dpt:41641
</code></pre><p>As a result, all Alibaba Cloud internal services became inaccessible. Some people simply avoid using Alibaba Cloud’s internal services altogether, but I rely on their mirror services, so that was not an option. Therefore, I disabled Tailscale’s netfilter rules entirely. The risk seemed minimal in my case:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tailscale up <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --accept-dns<span style=color:#f92672>=</span>false <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --netfilter-mode<span style=color:#f92672>=</span>nodivert <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --login-server https://hs.example.com:40000
</span></span></code></pre></div><p>The key parameter here is <code>--netfilter-mode=nodivert</code>. Tailscale will still create chains like <code>ts-input</code> and others, but it will not insert them into the <code>INPUT</code> chain, so they effectively do nothing.</p><h2 id=epilogue>Epilogue</h2><p>At this point, the entire setup is fully operational. All that remains is to log in on each device, which I will not go into here. There is also the process of configuring ACLs. With the help of ChatGPT, aside from a few minor pitfalls, that part went quite smoothly. Overall, the Tailscale experience has been excellent and completely solves the pain points I had with WireGuard. If the DNS feature becomes more powerful in the future, I would even consider moving DNS entirely onto the tailnet. On top of that, there are SSH, services, and many other advanced features. Once Headscale supports grants, I will definitely experiment with those as well.</p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">TAGGED IN</span><br><a class="tag tag--primary tag--small" href=https://blog.hljin.net/en-us/tags/headscale/>headscale</a>
<a class="tag tag--primary tag--small" href=https://blog.hljin.net/en-us/tags/headplane/>headplane</a>
<a class="tag tag--primary tag--small" href=https://blog.hljin.net/en-us/tags/tailscale/>tailscale</a>
<a class="tag tag--primary tag--small" href=https://blog.hljin.net/en-us/tags/openwrt/>openwrt</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.hljin.net/en-us/2025/11/pve-efi-boot-loader/ data-tooltip="Fixing 'unable to install the EFI boot loader' when installing PVE" aria-label="PREVIOUS: Fixing 'unable to install the EFI boot loader' when installing PVE"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#gitalk aria-label="Leave a comment"><i class="fa fa-comment"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div><div id=gitalk><noscript>Please enable JavaScript to view the comments powered by Gitalk.</noscript></div><script src=https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js integrity="sha512-EcTCcXV46teiNwe0VcnM5A038tcY+BaQYO4nW6Gh2i7v4/HjBVg7xx3+JBLl9WofDds//INJAiEGAtdgr8PWyA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script type=text/javascript>(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return}new Gitalk({clientID:"2d9c9d837f8496107211",clientSecret:"5a474517d0eb6d5abdb90ab9a31c2ba94f4f43b2",repo:"core2duoe6420.github.io",owner:"core2duoe6420",admin:["core2duoe6420"],id:"604f059d19bc6c9162e6bc5bb4972d16",...{distractionfreemode:!1,enablehotkey:!0,language:"zh-CN",pagerdirection:"first",perpage:10}}).render("gitalk")})()</script></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2025 Powered by Hugo with tranquilpeak. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.hljin.net/en-us/2025/11/pve-efi-boot-loader/ data-tooltip="Fixing 'unable to install the EFI boot loader' when installing PVE" aria-label="PREVIOUS: Fixing 'unable to install the EFI boot loader' when installing PVE"><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label="Share this post"><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#gitalk aria-label="Leave a comment"><i class="fa fa-comment"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label="Back to top"><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><img id=about-card-picture src=https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg alt="Author's picture"><h4 id=about-card-name>Alex King</h4><div id=about-card-bio>Observing without evaluating is the highest form of human intelligence</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>Human</div><div id=about-card-location><i class="fa fa-map-marker-alt"></i><br>Shanghai</div></div></div><div id=cover style=background-image:url(https://res.cloudinary.com/core2duoe6420/image/upload/v1643905455/20220204002352_yqvhwd.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://blog.hljin.net/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js></script>
<script async crossorigin=anonymous defer src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
<script>$(document).ready(function(){hljs.configure({classPrefix:"",useBR:!1}),$("pre.code-highlight > code, pre > code").each(function(e,t){$(this).hasClass("codeblock")||$(this).addClass("codeblock"),hljs.highlightBlock(t)})})</script></body></html>