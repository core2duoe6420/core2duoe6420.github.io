<!doctype html><html lang=zh-cn><head><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"libvirt安装黑群晖","datePublished":"2022-10-21T00:00:00Z","dateModified":"2022-10-21T00:00:00Z","author":{"@type":"Person","name":"Alex King","image":"https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.hljin.net\/2022\/10\/dsm-on-libvirt\/"},"publisher":{"@type":"Organization","name":"Alex King's blog","logo":{"@type":"ImageObject","url":"https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"}},"description":"最近升级NAS之后，空余出来2块10T的硬盘组不进阵列，原本想拿来多做一份ZFS的备份，结果发现zrepl不支持多目的地，就不想折腾了。正好又折腾好了WebVirtCloud， 就想试试看搞个黑群晖，将两块硬盘直通进去，这样又能多一个折腾的玩具。\n","keywords":[]}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.111.3 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content="Alex King"><meta name=keywords content><meta name=description content="最近升级NAS之后，空余出来2块10T的硬盘组不进阵列，原本想拿来多做一份ZFS的备份，结果发现zrepl不支持多目的地，就不想折腾了。正好又折腾好了WebVirtCloud，
就想试试看搞个黑群晖，将两块硬盘直通进去，这样又能多一个折腾的玩具。"><meta property="og:description" content="最近升级NAS之后，空余出来2块10T的硬盘组不进阵列，原本想拿来多做一份ZFS的备份，结果发现zrepl不支持多目的地，就不想折腾了。正好又折腾好了WebVirtCloud，
就想试试看搞个黑群晖，将两块硬盘直通进去，这样又能多一个折腾的玩具。"><meta property="og:type" content="article"><meta property="og:title" content="libvirt安装黑群晖"><meta name=twitter:title content="libvirt安装黑群晖"><meta property="og:url" content="https://blog.hljin.net/2022/10/dsm-on-libvirt/"><meta property="twitter:url" content="https://blog.hljin.net/2022/10/dsm-on-libvirt/"><meta property="og:site_name" content="Alex King's blog"><meta property="og:description" content="最近升级NAS之后，空余出来2块10T的硬盘组不进阵列，原本想拿来多做一份ZFS的备份，结果发现zrepl不支持多目的地，就不想折腾了。正好又折腾好了WebVirtCloud，
就想试试看搞个黑群晖，将两块硬盘直通进去，这样又能多一个折腾的玩具。"><meta name=twitter:description content="最近升级NAS之后，空余出来2块10T的硬盘组不进阵列，原本想拿来多做一份ZFS的备份，结果发现zrepl不支持多目的地，就不想折腾了。正好又折腾好了WebVirtCloud，
就想试试看搞个黑群晖，将两块硬盘直通进去，这样又能多一个折腾的玩具。"><meta property="og:locale" content="zh-cn"><meta property="article:published_time" content="2022-10-21T00:00:00"><meta property="article:modified_time" content="2022-10-21T00:00:00"><meta property="article:tag" content="DSM"><meta name=twitter:card content="summary"><meta property="og:image" content="https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"><meta property="twitter:image" content="https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg"><title>libvirt安装黑群晖</title><link rel=icon href=https://blog.hljin.net/favicon.png><link rel=canonical href=https://blog.hljin.net/2022/10/dsm-on-libvirt/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css integrity="sha512-MLcK/YRapzET1qTBXrOiZE6bGBgtATMo2bIyalVJ8EKDEGNoeA3SPQkvWAR0zNS650YG13ocXBMeioDuZcSRuQ==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://blog.hljin.net/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css><link rel=stylesheet href=https://blog.hljin.net/css/override.css></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=https://blog.hljin.net/ aria-label=去首页>Alex King's blog</a></div><a class=header-right-picture href=https://blog.hljin.net/#about aria-label="打开链接: /#about"><img class=header-picture src=https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg alt=作者的图片></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=https://blog.hljin.net/#about aria-label=阅读有关作者的更多信息><img class=sidebar-profile-picture src=https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg alt=作者的图片></a><h4 class=sidebar-profile-name>Alex King</h4><h5 class=sidebar-profile-bio>Observing without evaluating is the highest form of human intelligence</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>首页</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/categories title=Categories><i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden=true></i>
<span class=sidebar-button-desc>分类</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>标签</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/archives title=Archives><i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden=true></i>
<span class=sidebar-button-desc>归档</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://blog.hljin.net/#about title=About><i class="sidebar-button-icon fas fa-lg fa-user" aria-hidden=true></i>
<span class=sidebar-button-desc>关于</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/core2duoe6420 target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span></a></li></ul><ul class=sidebar-buttons></ul></div></nav><div id=main data-behavior=4 class=hasCoverMetaIn><article class=post id=top><div class="post-header main-content-wrap text-left"><h1 class=post-title>libvirt安装黑群晖</h1><div class="postShorten-meta post-meta"><time datetime=2022-10-21T00:00:00Z>十月 21, 2022</time></div></div><div class="post-content markdown"><div class=main-content-wrap><p>最近升级NAS之后，空余出来2块10T的硬盘组不进阵列，原本想拿来多做一份ZFS的备份，结果发现zrepl不支持多目的地，就不想折腾了。正好又折腾好了WebVirtCloud，
就想试试看搞个黑群晖，将两块硬盘直通进去，这样又能多一个折腾的玩具。</p><p>说起来自从裸机安装Ubuntu做NAS以来，别的功能都还好，就是虚拟机的管理界面我一直不满意。之前用了个很别扭的<a href=https://github.com/m-bers/docker-virt-manager>方案</a>，原理是用Broadway将桌面版的
Virtual Machine Manager转成Web版，用是能用，但是虚拟机的画面奇卡无比。WebVirtCloud使用Python写的纯Web版，虽然跟Proxmox，Unraid这些成熟产品不能比，但效果还是好不少，凑合着用了。</p><p>言归正传，先上各种参考资料：</p><ol><li><a href=https://www.wnark.com/archives/174.html>QEMU系列-黑群晖DSM7.0.1</a></li><li><a href=https://xpenology.com/forum/topic/62221-tutorial-installmigrate-to-dsm-7x-with-tinycore-redpill-tcrp-loader/>Tutorial: Install/Migrate to DSM 7.x with TinyCore RedPill (TCRP) Loader</a></li><li><a href=https://xpenology.com/forum/topic/61634-dsm-7x-loaders-and-platforms/>DSM 7.x Loaders and Platforms</a></li><li><a href=https://xpenology.com/forum/topic/63333-tutorial-install-dsm-71-on-unraid-6103>Tutorial: Install DSM 7.1 on UNRAID 6.10.3</a></li><li><a href=https://wp.gxnas.com/11876.html>群晖DSM7.X版本自动获取SataPortMap和DiskIdxMap的教程</a></li></ol><h2 id=环境>环境</h2><p>宿主机系统是Ubuntu 22.04，但是由于libvirt是安装在Docker容器里的，容器镜像基于Ubuntu 20.04 （因为22.04的libvirt会因为CGroup2的原因启动不了虚拟机），因此QEMU版本是4.2.1，libvirt版本6.0.0。</p><p>黑群晖的型号是DS918+，版本是截至当前最新的7.1.1-42962。</p><p>目前DSM7的引导基本都是用TinyCore RedPill (TCRP)做的，TCRP版本是<del>0.9.2.8</del> 0.9.2.9.</p><h2 id=硬件配置>硬件配置</h2><p>WebVirtCloud在硬件配置方面只能满足最基本的需求，好在支持XML配置。基本上基于KVM的虚拟机方案都会用到libvirt的XML配置，所以我这里直接给出我折腾成功的配置。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;domain</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;kvm&#39;</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#39;2&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;name&gt;</span>DSM<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;uuid&gt;</span>186682f9-0f0b-4a9e-867b-364706339405<span style=color:#f92672>&lt;/uuid&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;description&gt;</span>None<span style=color:#f92672>&lt;/description&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;memory</span> <span style=color:#a6e22e>unit=</span><span style=color:#e6db74>&#39;KiB&#39;</span><span style=color:#f92672>&gt;</span>4194304<span style=color:#f92672>&lt;/memory&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;currentMemory</span> <span style=color:#a6e22e>unit=</span><span style=color:#e6db74>&#39;KiB&#39;</span><span style=color:#f92672>&gt;</span>4194304<span style=color:#f92672>&lt;/currentMemory&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;vcpu</span> <span style=color:#a6e22e>placement=</span><span style=color:#e6db74>&#39;static&#39;</span><span style=color:#f92672>&gt;</span>2<span style=color:#f92672>&lt;/vcpu&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;resource&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;partition&gt;</span>/machine<span style=color:#f92672>&lt;/partition&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/resource&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;os&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;type</span> <span style=color:#a6e22e>arch=</span><span style=color:#e6db74>&#39;x86_64&#39;</span> <span style=color:#a6e22e>machine=</span><span style=color:#e6db74>&#39;pc-q35-4.2&#39;</span><span style=color:#f92672>&gt;</span>hvm<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;loader</span> <span style=color:#a6e22e>readonly=</span><span style=color:#e6db74>&#39;yes&#39;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pflash&#39;</span><span style=color:#f92672>&gt;</span>/usr/share/OVMF/OVMF_CODE.fd<span style=color:#f92672>&lt;/loader&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;nvram&gt;</span>/var/lib/libvirt/qemu/nvram/DSM_VARS.fd<span style=color:#f92672>&lt;/nvram&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;bootmenu</span> <span style=color:#a6e22e>enable=</span><span style=color:#e6db74>&#39;yes&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/os&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;features&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;acpi/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;apic/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/features&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;cpu</span> <span style=color:#a6e22e>mode=</span><span style=color:#e6db74>&#39;host-passthrough&#39;</span> <span style=color:#a6e22e>check=</span><span style=color:#e6db74>&#39;none&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;clock</span> <span style=color:#a6e22e>offset=</span><span style=color:#e6db74>&#39;utc&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;on_poweroff&gt;</span>destroy<span style=color:#f92672>&lt;/on_poweroff&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;on_reboot&gt;</span>restart<span style=color:#f92672>&lt;/on_reboot&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;on_crash&gt;</span>restart<span style=color:#f92672>&lt;/on_crash&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;devices&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;emulator&gt;</span>/usr/bin/qemu-system-x86_64<span style=color:#f92672>&lt;/emulator&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;disk</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;block&#39;</span> <span style=color:#a6e22e>device=</span><span style=color:#e6db74>&#39;disk&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;driver</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;qemu&#39;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;raw&#39;</span> <span style=color:#a6e22e>cache=</span><span style=color:#e6db74>&#39;none&#39;</span> <span style=color:#a6e22e>io=</span><span style=color:#e6db74>&#39;native&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;source</span> <span style=color:#a6e22e>dev=</span><span style=color:#e6db74>&#39;/dev/sdb&#39;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#39;3&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;backingStore/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>dev=</span><span style=color:#e6db74>&#39;sda&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;scsi&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;scsi0-0-0-0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;drive&#39;</span> <span style=color:#a6e22e>controller=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>target=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>unit=</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/disk&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;disk</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;block&#39;</span> <span style=color:#a6e22e>device=</span><span style=color:#e6db74>&#39;disk&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;driver</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;qemu&#39;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;raw&#39;</span> <span style=color:#a6e22e>cache=</span><span style=color:#e6db74>&#39;none&#39;</span> <span style=color:#a6e22e>io=</span><span style=color:#e6db74>&#39;native&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;source</span> <span style=color:#a6e22e>dev=</span><span style=color:#e6db74>&#39;/dev/sdc&#39;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#39;2&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;backingStore/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>dev=</span><span style=color:#e6db74>&#39;sdb&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;scsi&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;scsi0-0-0-1&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;drive&#39;</span> <span style=color:#a6e22e>controller=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>target=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>unit=</span><span style=color:#e6db74>&#39;1&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/disk&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;disk</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;file&#39;</span> <span style=color:#a6e22e>device=</span><span style=color:#e6db74>&#39;disk&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;driver</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;qemu&#39;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;raw&#39;</span> <span style=color:#a6e22e>cache=</span><span style=color:#e6db74>&#39;writeback&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;source</span> <span style=color:#a6e22e>file=</span><span style=color:#e6db74>&#39;/image/tinycore-redpill-uefi.v0.9.2.8.img&#39;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#39;1&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;backingStore/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>dev=</span><span style=color:#e6db74>&#39;hdz&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;usb&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;boot</span> <span style=color:#a6e22e>order=</span><span style=color:#e6db74>&#39;1&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;usb-disk25&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;usb&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>port=</span><span style=color:#e6db74>&#39;3&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/disk&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;controller</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pci&#39;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>model=</span><span style=color:#e6db74>&#39;pcie-root&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;pcie.0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/controller&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;controller</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;sata&#39;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;ide&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pci&#39;</span> <span style=color:#a6e22e>domain=</span><span style=color:#e6db74>&#39;0x0000&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0x00&#39;</span> <span style=color:#a6e22e>slot=</span><span style=color:#e6db74>&#39;0x1f&#39;</span> <span style=color:#a6e22e>function=</span><span style=color:#e6db74>&#39;0x2&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/controller&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;controller</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;usb&#39;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>model=</span><span style=color:#e6db74>&#39;qemu-xhci&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;usb&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pci&#39;</span> <span style=color:#a6e22e>domain=</span><span style=color:#e6db74>&#39;0x0000&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0x00&#39;</span> <span style=color:#a6e22e>slot=</span><span style=color:#e6db74>&#39;0x01&#39;</span> <span style=color:#a6e22e>function=</span><span style=color:#e6db74>&#39;0x0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/controller&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;controller</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;scsi&#39;</span> <span style=color:#a6e22e>index=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>model=</span><span style=color:#e6db74>&#39;virtio-scsi&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;scsi0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pci&#39;</span> <span style=color:#a6e22e>domain=</span><span style=color:#e6db74>&#39;0x0000&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0x00&#39;</span> <span style=color:#a6e22e>slot=</span><span style=color:#e6db74>&#39;0x02&#39;</span> <span style=color:#a6e22e>function=</span><span style=color:#e6db74>&#39;0x0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/controller&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;interface</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;bridge&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;mac</span> <span style=color:#a6e22e>address=</span><span style=color:#e6db74>&#39;xx:xx:xx:xx:xx:xx&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;source</span> <span style=color:#a6e22e>network=</span><span style=color:#e6db74>&#39;host-bridge&#39;</span> <span style=color:#a6e22e>portid=</span><span style=color:#e6db74>&#39;90d5d18c-6959-47ee-80b3-ce4774d28600&#39;</span> <span style=color:#a6e22e>bridge=</span><span style=color:#e6db74>&#39;br0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>dev=</span><span style=color:#e6db74>&#39;vnet0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;model</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;virtio&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;net0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pci&#39;</span> <span style=color:#a6e22e>domain=</span><span style=color:#e6db74>&#39;0x0000&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0x00&#39;</span> <span style=color:#a6e22e>slot=</span><span style=color:#e6db74>&#39;0x03&#39;</span> <span style=color:#a6e22e>function=</span><span style=color:#e6db74>&#39;0x0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/interface&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;video&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;model</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;vmvga&#39;</span> <span style=color:#a6e22e>vram=</span><span style=color:#e6db74>&#39;16384&#39;</span> <span style=color:#a6e22e>heads=</span><span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#a6e22e>primary=</span><span style=color:#e6db74>&#39;yes&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;video0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pci&#39;</span> <span style=color:#a6e22e>domain=</span><span style=color:#e6db74>&#39;0x0000&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0x00&#39;</span> <span style=color:#a6e22e>slot=</span><span style=color:#e6db74>&#39;0x04&#39;</span> <span style=color:#a6e22e>function=</span><span style=color:#e6db74>&#39;0x0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/video&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;memballoon</span> <span style=color:#a6e22e>model=</span><span style=color:#e6db74>&#39;virtio&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;balloon0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pci&#39;</span> <span style=color:#a6e22e>domain=</span><span style=color:#e6db74>&#39;0x0000&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0x00&#39;</span> <span style=color:#a6e22e>slot=</span><span style=color:#e6db74>&#39;0x05&#39;</span> <span style=color:#a6e22e>function=</span><span style=color:#e6db74>&#39;0x0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/memballoon&gt;</span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;serial</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pty&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;source</span> <span style=color:#a6e22e>path=</span><span style=color:#e6db74>&#39;/dev/pts/0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;isa-serial&#39;</span> <span style=color:#a6e22e>port=</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;model</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;isa-serial&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/target&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;serial0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/serial&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;console</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;pty&#39;</span> <span style=color:#a6e22e>tty=</span><span style=color:#e6db74>&#39;/dev/pts/0&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;source</span> <span style=color:#a6e22e>path=</span><span style=color:#e6db74>&#39;/dev/pts/0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;target</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;serial&#39;</span> <span style=color:#a6e22e>port=</span><span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;serial0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/console&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;input</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;mouse&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;ps2&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;input0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/input&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;input</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;keyboard&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;ps2&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;input1&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/input&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;graphics</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;spice&#39;</span> <span style=color:#a6e22e>port=</span><span style=color:#e6db74>&#39;5900&#39;</span> <span style=color:#a6e22e>autoport=</span><span style=color:#e6db74>&#39;yes&#39;</span> <span style=color:#a6e22e>listen=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;listen</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;address&#39;</span> <span style=color:#a6e22e>address=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/graphics&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;hub</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;usb&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;alias</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#39;hub0&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;address</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;usb&#39;</span> <span style=color:#a6e22e>bus=</span><span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#a6e22e>port=</span><span style=color:#e6db74>&#39;1&#39;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/hub&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/devices&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;seclabel</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#39;dynamic&#39;</span> <span style=color:#a6e22e>model=</span><span style=color:#e6db74>&#39;dac&#39;</span> <span style=color:#a6e22e>relabel=</span><span style=color:#e6db74>&#39;yes&#39;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;label&gt;</span>+0:+0<span style=color:#f92672>&lt;/label&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;imagelabel&gt;</span>+0:+0<span style=color:#f92672>&lt;/imagelabel&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/seclabel&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/domain&gt;</span>
</span></span></code></pre></div><p>最终运行的QEMU命令如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/usr/bin/qemu-system-x86_64 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -name guest<span style=color:#f92672>=</span>DSM,debug-threads<span style=color:#f92672>=</span>on <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -S <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -object secret,id<span style=color:#f92672>=</span>masterKey0,format<span style=color:#f92672>=</span>raw,file<span style=color:#f92672>=</span>/var/lib/libvirt/qemu/domain-5-DSM/master-key.aes <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;file&#34;</span>,<span style=color:#e6db74>&#34;filename&#34;</span>:<span style=color:#e6db74>&#34;/usr/share/OVMF/OVMF_CODE.fd&#34;</span>,<span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-pflash0-storage&#34;</span>,<span style=color:#e6db74>&#34;auto-read-only&#34;</span>:true,<span style=color:#e6db74>&#34;discard&#34;</span>:<span style=color:#e6db74>&#34;unmap&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-pflash0-format&#34;</span>,<span style=color:#e6db74>&#34;read-only&#34;</span>:true,<span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;raw&#34;</span>,<span style=color:#e6db74>&#34;file&#34;</span>:<span style=color:#e6db74>&#34;libvirt-pflash0-storage&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;file&#34;</span>,<span style=color:#e6db74>&#34;filename&#34;</span>:<span style=color:#e6db74>&#34;/var/lib/libvirt/qemu/nvram/DSM_VARS.fd&#34;</span>,<span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-pflash1-storage&#34;</span>,<span style=color:#e6db74>&#34;auto-read-only&#34;</span>:true,<span style=color:#e6db74>&#34;discard&#34;</span>:<span style=color:#e6db74>&#34;unmap&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-pflash1-format&#34;</span>,<span style=color:#e6db74>&#34;read-only&#34;</span>:false,<span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;raw&#34;</span>,<span style=color:#e6db74>&#34;file&#34;</span>:<span style=color:#e6db74>&#34;libvirt-pflash1-storage&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -machine pc-q35-4.2,accel<span style=color:#f92672>=</span>kvm,usb<span style=color:#f92672>=</span>off,dump-guest-core<span style=color:#f92672>=</span>off,pflash0<span style=color:#f92672>=</span>libvirt-pflash0-format,pflash1<span style=color:#f92672>=</span>libvirt-pflash1-format <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -cpu host <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -m <span style=color:#ae81ff>4096</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -overcommit mem-lock<span style=color:#f92672>=</span>off <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -smp 2,sockets<span style=color:#f92672>=</span>2,cores<span style=color:#f92672>=</span>1,threads<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -uuid 186682f9-0f0b-4a9e-867b-364706339405 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -no-user-config <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -nodefaults <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -chardev socket,id<span style=color:#f92672>=</span>charmonitor,fd<span style=color:#f92672>=</span>44,server,nowait <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -mon chardev<span style=color:#f92672>=</span>charmonitor,id<span style=color:#f92672>=</span>monitor,mode<span style=color:#f92672>=</span>control <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -rtc base<span style=color:#f92672>=</span>utc <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -no-shutdown <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -boot menu<span style=color:#f92672>=</span>on,strict<span style=color:#f92672>=</span>on <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device qemu-xhci,id<span style=color:#f92672>=</span>usb,bus<span style=color:#f92672>=</span>pcie.0,addr<span style=color:#f92672>=</span>0x1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device virtio-scsi-pci,id<span style=color:#f92672>=</span>scsi0,bus<span style=color:#f92672>=</span>pcie.0,addr<span style=color:#f92672>=</span>0x2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device usb-hub,id<span style=color:#f92672>=</span>hub0,bus<span style=color:#f92672>=</span>usb.0,port<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;host_device&#34;</span>,<span style=color:#e6db74>&#34;filename&#34;</span>:<span style=color:#e6db74>&#34;/dev/sdb&#34;</span>,<span style=color:#e6db74>&#34;aio&#34;</span>:<span style=color:#e6db74>&#34;native&#34;</span>,<span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-3-storage&#34;</span>,<span style=color:#e6db74>&#34;cache&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;direct&#34;</span>:true,<span style=color:#e6db74>&#34;no-flush&#34;</span>:false<span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;auto-read-only&#34;</span>:true,<span style=color:#e6db74>&#34;discard&#34;</span>:<span style=color:#e6db74>&#34;unmap&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-3-format&#34;</span>,<span style=color:#e6db74>&#34;read-only&#34;</span>:false,<span style=color:#e6db74>&#34;cache&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;direct&#34;</span>:true,<span style=color:#e6db74>&#34;no-flush&#34;</span>:false<span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;raw&#34;</span>,<span style=color:#e6db74>&#34;file&#34;</span>:<span style=color:#e6db74>&#34;libvirt-3-storage&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device scsi-hd,bus<span style=color:#f92672>=</span>scsi0.0,channel<span style=color:#f92672>=</span>0,scsi-id<span style=color:#f92672>=</span>0,lun<span style=color:#f92672>=</span>0,device_id<span style=color:#f92672>=</span>drive-scsi0-0-0-0,drive<span style=color:#f92672>=</span>libvirt-3-format,id<span style=color:#f92672>=</span>scsi0-0-0-0,write-cache<span style=color:#f92672>=</span>on <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;host_device&#34;</span>,<span style=color:#e6db74>&#34;filename&#34;</span>:<span style=color:#e6db74>&#34;/dev/sdc&#34;</span>,<span style=color:#e6db74>&#34;aio&#34;</span>:<span style=color:#e6db74>&#34;native&#34;</span>,<span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-2-storage&#34;</span>,<span style=color:#e6db74>&#34;cache&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;direct&#34;</span>:true,<span style=color:#e6db74>&#34;no-flush&#34;</span>:false<span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;auto-read-only&#34;</span>:true,<span style=color:#e6db74>&#34;discard&#34;</span>:<span style=color:#e6db74>&#34;unmap&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-2-format&#34;</span>,<span style=color:#e6db74>&#34;read-only&#34;</span>:false,<span style=color:#e6db74>&#34;cache&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;direct&#34;</span>:true,<span style=color:#e6db74>&#34;no-flush&#34;</span>:false<span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;raw&#34;</span>,<span style=color:#e6db74>&#34;file&#34;</span>:<span style=color:#e6db74>&#34;libvirt-2-storage&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device scsi-hd,bus<span style=color:#f92672>=</span>scsi0.0,channel<span style=color:#f92672>=</span>0,scsi-id<span style=color:#f92672>=</span>0,lun<span style=color:#f92672>=</span>1,device_id<span style=color:#f92672>=</span>drive-scsi0-0-0-1,drive<span style=color:#f92672>=</span>libvirt-2-format,id<span style=color:#f92672>=</span>scsi0-0-0-1,write-cache<span style=color:#f92672>=</span>on <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;file&#34;</span>,<span style=color:#e6db74>&#34;filename&#34;</span>:<span style=color:#e6db74>&#34;/image/tinycore-redpill-uefi.v0.9.2.8.img&#34;</span>,<span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-1-storage&#34;</span>,<span style=color:#e6db74>&#34;cache&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;direct&#34;</span>:false,<span style=color:#e6db74>&#34;no-flush&#34;</span>:false<span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;auto-read-only&#34;</span>:true,<span style=color:#e6db74>&#34;discard&#34;</span>:<span style=color:#e6db74>&#34;unmap&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -blockdev <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;node-name&#34;</span>:<span style=color:#e6db74>&#34;libvirt-1-format&#34;</span>,<span style=color:#e6db74>&#34;read-only&#34;</span>:false,<span style=color:#e6db74>&#34;cache&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;direct&#34;</span>:false,<span style=color:#e6db74>&#34;no-flush&#34;</span>:false<span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;driver&#34;</span>:<span style=color:#e6db74>&#34;raw&#34;</span>,<span style=color:#e6db74>&#34;file&#34;</span>:<span style=color:#e6db74>&#34;libvirt-1-storage&#34;</span><span style=color:#f92672>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device usb-storage,bus<span style=color:#f92672>=</span>usb.0,port<span style=color:#f92672>=</span>3,drive<span style=color:#f92672>=</span>libvirt-1-format,id<span style=color:#f92672>=</span>usb-disk25,bootindex<span style=color:#f92672>=</span>1,removable<span style=color:#f92672>=</span>off,write-cache<span style=color:#f92672>=</span>on <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -netdev tap,fd<span style=color:#f92672>=</span>46,id<span style=color:#f92672>=</span>hostnet0,vhost<span style=color:#f92672>=</span>on,vhostfd<span style=color:#f92672>=</span><span style=color:#ae81ff>47</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device virtio-net-pci,netdev<span style=color:#f92672>=</span>hostnet0,id<span style=color:#f92672>=</span>net0,mac<span style=color:#f92672>=</span>xx:xx:xx:xx:xx:xx,bus<span style=color:#f92672>=</span>pcie.0,addr<span style=color:#f92672>=</span>0x3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -chardev pty,id<span style=color:#f92672>=</span>charserial0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device isa-serial,chardev<span style=color:#f92672>=</span>charserial0,id<span style=color:#f92672>=</span>serial0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -spice port<span style=color:#f92672>=</span>5900,addr<span style=color:#f92672>=</span>0.0.0.0,disable-ticketing,seamless-migration<span style=color:#f92672>=</span>on <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device vmware-svga,id<span style=color:#f92672>=</span>video0,vgamem_mb<span style=color:#f92672>=</span>16,bus<span style=color:#f92672>=</span>pcie.0,addr<span style=color:#f92672>=</span>0x4 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -device virtio-balloon-pci,id<span style=color:#f92672>=</span>balloon0,bus<span style=color:#f92672>=</span>pcie.0,addr<span style=color:#f92672>=</span>0x5 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -sandbox on,obsolete<span style=color:#f92672>=</span>deny,elevateprivileges<span style=color:#f92672>=</span>deny,spawn<span style=color:#f92672>=</span>deny,resourcecontrol<span style=color:#f92672>=</span>deny <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -msg timestamp<span style=color:#f92672>=</span>on
</span></span></code></pre></div><p>简单说明一下这个配置：</p><ul><li>芯片组选的Q35，BIOS用UEFI，因此TCRP的镜像也要下载UEFI的版本</li><li>CPU选<code>host-passthrough</code>。DS918+只支持Haswell及以后的CPU，具体的看参考链接</li><li>USB总线model选<code>qemu-xhci</code>，这个是USB3.0，默认的是USB2.0</li><li>两块直通的硬盘挂在了SCSI总线上。SATA总线也可以，但是QEMU虚拟出来的这个Q35的SATA控制器，只支持SATA 1.0的速度，也就是1.5Gbps，实测下来读取速度最高150MiB/s。况且TCRP还把这个标记为了Bogus Q35，所以最好别用</li><li>SCSI控制器用的是<code>virtio-scsi</code>，这个需要额外安装驱动，不过VirtIO性能好，可以最大程度发挥硬盘性能</li><li>网卡用的是<code>virtio</code>，需要安装驱动。我先后试过<code>e1000e</code>和<code>vmxnet3</code>。<code>e1000e</code>用了之后DS918+会掉IP，无法引导。<code>vmxnet3</code>在VMWare里是个万兆网卡，结果我试下来在QEMU里链路速率只有千兆，用iperf3做多线程测试的时候，
甚至只能跑到600Mbps。VirtIO性能好，iperf3与宿主机测试可以跑到26Gbps（我的虚拟网络拓扑有两个bridge，不然说不定能跑到更高）</li><li>我研究了下libvirt的PCIe配置，为了XML看起来更简洁些，我把所有设备都挂到了bus 0上，所以在XML里没有<code>pcie-root-port</code>和<code>pcie-pci-bridge</code>设备，目前测试下来感觉并没有性能损失，不清楚PCIe设备的拓扑图到底会有啥影响</li></ul><h2 id=配置tcrp>配置TCRP</h2><p>开机引导至TCRP Loader，用SSH登陆，用户名是<code>tc</code>，密码默认是<code>P@ssw0rd</code>，然后依次运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./rploader.sh fullupgrade
</span></span><span style=display:flex><span>./rploader.sh serialgen DS918+ realmac
</span></span><span style=display:flex><span>./rploader.sh identifyusb
</span></span><span style=display:flex><span>./rploader.sh satamap
</span></span><span style=display:flex><span>cat user_config.json | jq <span style=color:#e6db74>&#39;.extra_cmdline.SataPortMap = &#34;12&#34;&#39;</span> | jq <span style=color:#e6db74>&#39;.extra_cmdline.DiskIdxMap = &#34;1000&#34;&#39;</span> | tee user_config.json
</span></span><span style=display:flex><span>./rploader.sh ext ds918p-7.1.1-42962 add https://github.com/pocopico/redpill-load/raw/develop/redpill-virtio/rpext-index.json
</span></span><span style=display:flex><span>./rploader.sh ext ds918p-7.1.1-42962 add https://github.com/pocopico/redpill-load/raw/develop/redpill-acpid/rpext-index.json
</span></span><span style=display:flex><span>./rploader.sh build ds918p-7.1.1-42962
</span></span></code></pre></div><p>重启，用Synology Assitant找到DSM，上传7.1.1-42962的PAT文件，搞定收工。</p><p>看着挺简单的，但是这是我来来回回折腾了十几遍得出的结果，其中有几个坑：</p><ul><li>关于<code>SataPortMap</code>和<code>DiskIdxMap</code>这两个参数的配置，根据硬件配置，我有两个控制器，一个是Q35的SATA控制器，一个是<code>virtio-scsi</code>驱动的SCSI控制器，Q35的控制器没有使用，所以对应的<code>DiskIdxMap</code>设为了<code>10</code>，
超过了硬盘数量上限，会被忽略，SCSI控制器上挂了两块硬盘，所以对应的<code>SataPortMap</code>是2，对应的<code>DiskIdxMap</code>是<code>00</code>，表示从第一块盘开始</li><li>增加的extention <code>acpid</code>是为了支持按关机键可以关机，这样可以通过<code>virsh shutdown DSM</code>正常关机</li><li><del>VirtIO驱动的问题，我安装的时候TCRP仓库里的VirtIO驱动还没加上<code>7.1.1-42962</code>，只更新到<code>7.1.0-42661</code>，于是我克隆了仓库，加入了<code>ds918p_42962</code>，然后手动添加extension。事实证明驱动本身可以使用，
只需要加个配置就行，这个问题等过一段时间TCRP仓库更新了就能解决。一开始的时候我安装了<code>7.1.0-42661</code>版本，也能成功，然后尝试在DSM系统里直接更新，结果失败，重启后就进不了系统了</del> 仓库已更新，可直接使用</li><li><del>比较奇怪的一点是<code>serialgen</code>命令接收的是型号参数，而<code>build</code>命令接收的是CPU代号，因为我折腾的过程中试过好几个型号（DS918+，DS3622xs+，DS3617xs），所以特别烦这个，最后在参考资料#3中找到了好用的对应表，
我把那个贴这里供参考：</del> 最新版居然统一了命令，表格就留在这里作参考了<table><thead><tr><th>DSM Platform</th><th>DS918+</th><th>DS3622xs+</th><th>DS920+</th><th>DS1621+</th><th>DS3617xs</th><th>DVA3221</th><th>DS3615xs</th></tr></thead><tbody><tr><td>Architecture</td><td>apollolake</td><td>broadwellnk</td><td>geminilake</td><td>v1000</td><td>broadwell</td><td>denverton</td><td>bromolow</td></tr><tr><td>Drive Slot Mapping</td><td>sataportmap<br>/diskidxmap</td><td>sataportmap<br>/diskidxmap</td><td>device tree</td><td>device tree</td><td>sataportmap<br>/diskidxmap</td><td>sataportmap<br>/diskidxmap</td><td>sataportmap<br>/diskidxmap</td></tr><tr><td>QuickSync Transcoding</td><td>Yes</td><td>No</td><td>Yes</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td>NVMe Cache Support</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes (as of 7.0)</td><td>Yes</td><td>No</td></tr><tr><td>RAIDF1 Support</td><td>No</td><td>Yes</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>Oldest CPU Supported</td><td>Haswell</td><td>any x86-64</td><td>Haswell</td><td>any x86-64</td><td>any x86-64</td><td>Haswell</td><td>any x86-64</td></tr><tr><td>Max CPU Threads</td><td>8</td><td>24</td><td>8</td><td>16</td><td>24 (as of 7.0)</td><td>16</td><td>16</td></tr><tr><td>Key Note</td><td>currently best for most users</td><td>best for very large installs</td><td></td><td>AMD Ryzen</td><td>obsolete use DS3622xs+</td><td>AI/Deep Learning nVIDIA GPU</td><td>obsolete use DS3622xs+</td></tr></tbody></table></li></ul></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small" href=https://blog.hljin.net/tags/dsm/>DSM</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.hljin.net/2023/10/kotlin-coroutine-mysteries/ data-tooltip="Kotlin Coroutine踩坑记录" aria-label="下一篇: Kotlin Coroutine踩坑记录"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">下一篇</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.hljin.net/2022/04/kotlin-coroutine-note/ data-tooltip="Kotlin Coroutine笔记" aria-label="上一篇: Kotlin Coroutine笔记"><span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=分享这个帖子><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#gitalk aria-label=发表评论><i class="fa fa-comment"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=回到顶部><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div><div id=gitalk><noscript>Please enable JavaScript to view the comments powered by Gitalk.</noscript></div><script src=https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js integrity="sha512-EcTCcXV46teiNwe0VcnM5A038tcY+BaQYO4nW6Gh2i7v4/HjBVg7xx3+JBLl9WofDds//INJAiEGAtdgr8PWyA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script type=text/javascript>(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return}new Gitalk({clientID:"2d9c9d837f8496107211",clientSecret:"5a474517d0eb6d5abdb90ab9a31c2ba94f4f43b2",repo:"core2duoe6420.github.io",owner:"core2duoe6420",admin:["core2duoe6420"],id:"02e30f159e79f76889bf4746e16bad85",...{distractionfreemode:!1,enablehotkey:!0,language:"zh-CN",pagerdirection:"first",perpage:10}}).render("gitalk")})()</script></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2023 Powered by Hugo with tranquilpeak. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.hljin.net/2023/10/kotlin-coroutine-mysteries/ data-tooltip="Kotlin Coroutine踩坑记录" aria-label="下一篇: Kotlin Coroutine踩坑记录"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">下一篇</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://blog.hljin.net/2022/04/kotlin-coroutine-note/ data-tooltip="Kotlin Coroutine笔记" aria-label="上一篇: Kotlin Coroutine笔记"><span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=分享这个帖子><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#gitalk aria-label=发表评论><i class="fa fa-comment"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=回到顶部><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><img id=about-card-picture src=https://res.cloudinary.com/core2duoe6420/image/upload/v1643906248/DSC_5117_wviusa.jpg alt=作者的图片><h4 id=about-card-name>Alex King</h4><div id=about-card-bio>Observing without evaluating is the highest form of human intelligence</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>Human</div><div id=about-card-location><i class="fa fa-map-marker-alt"></i><br>Shanghai</div></div></div><div id=cover style=background-image:url(https://res.cloudinary.com/core2duoe6420/image/upload/v1643905455/20220204002352_yqvhwd.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://blog.hljin.net/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js></script>
<script async crossorigin=anonymous defer src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
<script>$(document).ready(function(){hljs.configure({classPrefix:"",useBR:!1}),$("pre.code-highlight > code, pre > code").each(function(e,t){$(this).hasClass("codeblock")||$(this).addClass("codeblock"),hljs.highlightBlock(t)})})</script></body></html>